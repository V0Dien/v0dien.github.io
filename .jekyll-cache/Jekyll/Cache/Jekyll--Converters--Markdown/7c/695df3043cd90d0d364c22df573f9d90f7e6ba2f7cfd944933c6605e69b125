I"(<p>Cách mình patch code và nghịch ngợm 1 file APK.</p>

<h2 id="0x01-các-công-cụ-cần-thiết">0x01: Các công cụ cần thiết:</h2>

<p>Các bạn tải những công cụ:</p>
<ul>
  <li><a href="https://ibotpeaches.github.io/Apktool/">apktool</a>_Công cụ giúp chúng ta decompile từ 1 file APK sang mã nguồn smali và Recompile thành 1 file APK mới.</li>
  <li>keytool_Công cụ giúp tạo certificate.</li>
  <li>jarsigner_Công cụ giúp ký chữ ký được tạo từ keytool.</li>
  <li>zipalign_Công cụ tinh chỉnh nén cho file APK.</li>
</ul>

<h2 id="0x02-cách-cài-đặt">0x02: Cách cài đặt</h2>

<p>Những công cụ được nêu trên đều có thể dễ dàng cài đặt trên các package của Linux. Ở đây mình sử dụng Ubuntu:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> apktool zipalign default-jdk
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Trên hệ điều hành Windows thì các bạn phải cài từng gói riêng và thêm path vào Enviroment để các công cụ trên có thể hoạt động tốt nhất.</p>

<h2 id="0x03-decompile">0x03: Decompile</h2>

<p>Cách mình thường làm đó là:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>apktool d &lt;app_name&gt;.apk
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Sau đó chỉnh sửa smali code của file apk vừa decompile.</p>

<p>Cách khác giúp bạn nào chưa quen smali code vẫn có thể giúp bạn dễ patch hơn bằng code java, tuy nhiên cách này mình không dùng thường xuyên vì nó phải convert quá nhiều lần dẫn đến app sau khi patch bị lỗi và không thể hoạt động.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>apktool d <span class="nt">-rs</span> &lt;app_name&gt;.apk
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Cách này sẽ không decompile mã nguồn sang smali code mà sẽ để ở dạng đuôi <code class="language-plaintext highlighter-rouge">.dex</code>.
Để đọc và chỉnh sửa dễ dàng hơn, ta cài đặt <a href="https://github.com/pxb1988/dex2jar">dex2jar</a>. Sử dụng <a href="http://java-decompiler.github.io/">jd-gui</a> để đọc code và dùng jar trong jdk để compile file mới sau khi đã chỉnh sửa và recompile lại file apk.</p>

<h2 id="0x04-recompile">0x04: Recompile</h2>

<p>Sau khi đã chỉnh sửa, chúng ta cần đóng gói lại thành 1 file APK mới.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>apktool b
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Tiếp đến cần tạo certificate để có thể kí trước khi xuất bản:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>keytool <span class="nt">-genkey</span> <span class="nt">-v</span> <span class="nt">-keystore</span> apk-sign.key <span class="nt">-alias</span> alias_name <span class="nt">-keyalg</span> RSA <span class="nt">-keysize</span> 2048 <span class="nt">-validity</span> 10000
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Khi các bạn tạo cert sẽ có yêu cầu tạo password, cứ nhập gì cũng được nhưng hãy chắc chắn là các bạn nhớ nó vì password sẽ được nhập trong bước kí file APK.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>jarsigner <span class="nt">-verbose</span> <span class="nt">-sigalg</span> SHA1withRSA <span class="nt">-digestalg</span> SHA1 <span class="nt">-keystore</span> apk-sign.key &lt;new_app_name&gt;.apk alias_name
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Cuối cùng là dùng zipalign:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>zipalign <span class="nt">-v</span> 4 my_application.apk my_application-aligned.apk
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Cheer (☞ﾟヮﾟ)☞☜(ﾟヮﾟ☜)</p>
:ET